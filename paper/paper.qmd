---
title: "Magic Vs Evolution"
subtitle: "Or more specifically language in Harry Potter vs Darwin's Natural Selection"
author: "Shreya Sakura Noskor"
thanks: "Code and data are available at: [HarryDarwin](https://github.com/NotSakura/HarryDarwin.git)"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
header-includes:
  - \usepackage{float} 
  - \floatplacement{table}{H}
number-sections: true
include-in-header: 
  text:
    \renewcommand{\abstractname}{Abstract}
bibliography: references.bib
toc: true
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(gutenbergr)
library(pdftools)
library(arrow)
library(dplyr)
library(stringr)
library(rstanarm)
library(marginaleffects)
```


```{r}
#| echo: false
#| warning: false
#| message: false
darwin <-
  gutenberg_download(
    gutenberg_id = 2009,
    mirror = "https://gutenberg.pglaf.org/"
  )

darwin

write_csv(darwin, "../data/raw_data/darwin.csv")



```


```{r}
#| echo: false
#| warning: false
#| message: false
harry <- pdf_text("../other/literature/HarryAzkaban.pdf")
class(harry)
harry <- tibble(
  raw_text = harry,
  page_number = c(1:454)
)

harry <- 
  separate_rows(harry, raw_text, sep = "\\n", convert = FALSE)

write_csv(harry, "../data/raw_data/harry.csv")

```


```{r}
#| echo: false
#| warning: false
#| message: false
darwin <- read_csv(
  "../data/raw_data/darwin.csv",
  col_types = cols(
    gutenberg_id = col_integer(),
    text = col_character()
  )
)

harry <- read_csv(
  "../data/raw_data/harry.csv",
  col_types = cols(
    page_num = col_integer(),
    text = col_character()
  )
)



darwin_reduced <- darwin |>
  filter(!is.na(text)) |> 
  mutate(natural_count = str_count(text, regex('natural|species', ignore_case = T)), 
         magic_count = str_count(text, regex('magic|miracle', ignore_case = T)), 
         word_count = str_count(text, "\\w+"))

write_csv(darwin_reduced, "../data/analysis_data/darwin_reduced.csv")
arrow::write_parquet(darwin_reduced, "../data/analysis_data/darwin_reduced.parquet")


harry_reduced <- harry |>
  filter(!is.na(raw_text)) |> 
  mutate(natural_count = str_count(raw_text, regex('natural|species', ignore_case = T)), 
         magic_count = str_count(raw_text, regex('magic|miracle', ignore_case = T)), 
         word_count = str_count(raw_text, "\\w+"))

write_csv(darwin_reduced, "../data/analysis_data/harry_reduced.csv")
arrow::write_parquet(darwin_reduced, "../data/analysis_data/harry_reduced.parquet")



```




# Introduction

Research Question: Does the topic we talk about influence our language, or does the laguage influence the theme of the topic. 


# Data {#sec-data}

## Source
The data utilized was from Project Gutenburg and PDF Drives and with the help of R [@citeR] we were able to create this paper. Also code for making the models were made referencing Telling Stories by Rohan Alexander[@rohan]. Other R packages were used to clean, process and model the data such as, @tidy, @gut, @rstanarm, @pdf, @dplyr, @arrow, @stringr, @marginaleffects.

## Variables

### Distribution of each word with each text 


# Model

## Natural and the 2 texts

Define $y_i$ is the number of times "natural" appeared in each text and the explanatory variable is the number of words in the line. We predict to see that there is a positive correlation in Darwin's text but not in Harry Potter due to the difference in topics.

\begin{align} 
y_i|\lambda_i &\sim \mbox{Poisson}(\lambda_i) \\
\mbox{log}(\lambda_i) &= \beta_0 + \beta_1 \times \mbox{Number } \mbox{of } \mbox{Words}_i\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.
```{r}
#| echo: false
#| warning: false
#| message: false
darwin_nature <-
  stan_glm(
    natural_count ~ word_count,
    data = darwin_reduced,
    family = poisson(link = "log"),
    prior = normal(location = 0, scale = 2.5, autoscale = TRUE),
    prior_intercept = normal(location = 0, scale = 2.5, autoscale = TRUE),
    seed = 853
  )

saveRDS(
  darwin_nature,
  file = "../models/darwin_nature.rds"
)


harry_nature <-
  stan_glm(
    natural_count ~ word_count,
    data = harry_reduced,
    family = poisson(link = "log"),
    prior = normal(location = 0, scale = 2.5, autoscale = TRUE),
    prior_intercept = normal(location = 0, scale = 2.5, autoscale = TRUE),
    seed = 853
  )

saveRDS(
  harry_nature,
  file = "../models/harry_nature.rds"
)
```

```{r}
#| echo: false
#| warning: false
#| message: false
plot_predictions(darwin_nature, condition = "word_count") +
  labs(x = "Number of words",
       y = "Average number of \"natural\"s in the first 10 lines") +
  theme_classic()
```
positive correlation it seems

```{r}
#| echo: false
#| warning: false
#| message: false
plot_predictions(harry_nature, condition = "word_count") +
  labs(x = "Number of words",
       y = "Average number of \"natural\"s in the first 10 lines") +
  theme_classic()
```
No correlation at all

### Model justification

We predict to see that there is a positive correlation in Darwin's text but not in Harry Potter due to the difference in topics.

## "Magic" and the 2 texts
Define $y_i$ is the number of times "magic" or "miracle" appeared in the text and the explanatory variable is the number of words in the line.

\begin{align} 
y_i|\lambda_i &\sim \mbox{Poisson}(\lambda_i) \\
\mbox{log}(\lambda_i) &= \beta_0 + \beta_1 \times \mbox{Number } \mbox{of } \mbox{Words}_i\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\end{align}


We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.
```{r}
#| echo: false
#| warning: false
#| message: false
darwin_magic <-
  stan_glm(
    magic_count ~ word_count,
    data = darwin_reduced,
    family = poisson(link = "log"),
    prior = normal(location = 0, scale = 2.5, autoscale = TRUE),
    prior_intercept = normal(location = 0, scale = 2.5, autoscale = TRUE),
    seed = 853
  )

saveRDS(
  darwin_magic,
  file = "../models/darwin_magic.rds"
)


harry_magic <-
  stan_glm(
    magic_count ~ word_count,
    data = harry_reduced,
    family = poisson(link = "log"),
    prior = normal(location = 0, scale = 2.5, autoscale = TRUE),
    prior_intercept = normal(location = 0, scale = 2.5, autoscale = TRUE),
    seed = 853
  )

saveRDS(
  harry_magic,
  file = "../models/harry_magic.rds"
)
```

```{r}
#| echo: false
#| warning: false
#| message: false
plot_predictions(darwin_magic, condition = "word_count") +
  labs(x = "Number of words",
       y = "Average number of \"magic\"s or \"miracle\"s appearing") +
  theme_classic()
```
As we can see here there is almost no correlation at all. 

```{r}
#| echo: false
#| warning: false
#| message: false
plot_predictions(harry_magic, condition = "word_count") +
  labs(x = "Number of words",
       y = "Average number of \"magic\"s or \"miracle\"s appearing") +
  theme_classic()
```

### Model justification

We predict to see that there is a positive correlation in Harry Potter but not in Darwin's text due to the difference in topics.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

darwin_nature <-
  readRDS(file = "../models/darwin_nature.rds")

darwin_magic <-
  readRDS(file = "../models/darwin_magic.rds")


harry_nature <-
  readRDS(file = "../models/harry_nature.rds")

harry_magic <-
  readRDS(file = "../models/harry_magic.rds")
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-darwin_nature
#| tbl-cap: "Model Summary showcasing the correlation coeffcient for Darwin's evolution book and the word nature"
#| warning: false

modelsummary::modelsummary(
  list(
    "darwin and nature" = darwin_nature
  ),
  statistic = "mad",
  fmt = 2
)
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-darwin_magic
#| tbl-cap: "Model Summary showcasing the correlation coeffcient for Darwin's evolution book and the word magic"
#| warning: false

modelsummary::modelsummary(
  list(
    "darwin and magic" = darwin_magic
  ),
  statistic = "mad",
  fmt = 2
)
```



```{r}
#| echo: false
#| eval: true
#| label: tbl-harry_nature
#| tbl-cap: "Model Summary showcasing the correlation coeffcient for  Harry Potter and The Prisoner of Azkaban and the word nature"
#| warning: false

modelsummary::modelsummary(
  list(
    "harry and nature" = harry_nature
  ),
  statistic = "mad",
  fmt = 2
)
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-harry_magic
#| tbl-cap: "Model Summary showcasing the correlation coeffcient for Harry Potter and The Prisoner of Azkaban and the word magic"
#| warning: false

modelsummary::modelsummary(
  list(
    "harry and magic" = harry_magic
  ),
  statistic = "mad",
  fmt = 2
)
```


# Discussion

## Why is the result the way it is {#sec-first-point}


## Importance

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}



\newpage


# References


